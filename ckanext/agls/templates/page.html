{% ckan_extends %}
{% block scripts %}
    <!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
{% resource 'ckanext-agls/styles/kalendae.standalone.js' %}
{% resource 'ckanext-agls/scripts/agls-ltz.js' %}
{% resource 'ckanext-agls/styles/kalendae.css' %}

    {{ super() }}
    <style>
        .form-horizontal .controls, .form-horizontal .controls ol li {
            font-size: 0.8em;
            line-height: 15px;
        }
        .form-horizontal .controls *{
            font-size: 14px;

        }
        .form-horizontal .controls a{
            font-size: 0.8em;
        }
    </style>
    <script>
    function gazSearch(gazURL) {
        var re = new RegExp("submit1=(.*\\d)(&|$)");
        var m = re.exec(gazURL);
        if (m != null) {
            gazID = m[1];
            $.getJSON("/api/2/util/gazetteer/latlon?q=" + gazID, function (data) {
                if (data.geojson != undefined) {
                    $('#spatial').val(data.geojson);
                }
            })
        } else {
            var re2 = new RegExp("[a-zA-Z].*\\d");
            var m2 = re2.exec(gazURL);
            if (m2 != null) {
                gazID = m2[0];
                $.getJSON("/api/2/util/gazetteer/latlon?q=" + gazID, function (data) {
                    if (data.geojson != undefined) {
                        $('#spatial').val(data.geojson);
                    }
                })
            }
        }
    }
    var prev_handler = window.onload;
    window.onload = function () {
        if (prev_handler) {
            prev_handler();
        }
            $("#field-spatial_coverage").change(function (e) {
                gazURL = e.target.value;
                gazSearch(gazURL);
            });
            gazSearch($("#field-spatial_coverage").val());
            $(function() {
                $( "#field-temporal_coverage-from" ).kalendae({format:"YYYY-MM-DD"});
                $( "#field-temporal_coverage-from").focusout(function() {
                    var date = moment($( "#field-temporal_coverage-from").val());
                    if (date.format("YYYY-MM-DD") == 'Invalid date') {
                     window.alert('Invalid Date. Please enter in Year-Month-Day format eg. 2012-05-15.')
                    }else {
                        $("#field-temporal_coverage-from").val(date.format("YYYY-MM-DD"));
                    }
                });

                $( "#field-temporal_coverage-to" ).kalendae({format:"YYYY-MM-DD"});
                $( "#field-temporal_coverage-to").focusout(function() {
                    var date = moment($( "#field-temporal_coverage-to").val());
                    if (date.format("YYYY-MM-DD") == 'Invalid date') {
                        window.alert('Invalid Date. Please enter in Year-Month-Day format eg. 2012-05-15.')
                    }else {
                        $("#field-temporal_coverage-to").val(date.format("YYYY-MM-DD"));
                    }
                });
            });

        };

    </script>

{% endblock %}
